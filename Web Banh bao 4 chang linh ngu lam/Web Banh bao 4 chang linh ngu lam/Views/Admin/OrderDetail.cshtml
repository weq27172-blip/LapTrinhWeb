@model Web_Banh_bao_4_chang_linh_ngu_lam.Models.OrderPro

@{
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
    ViewBag.Title = "Chi tiết đơn hàng";
}

<div class="container py-4">

    <h2 class="mb-4 text-primary">Chi tiết đơn hàng #@Model.ID</h2>

    <!-- Customer / Order Info -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title">Thông tin khách hàng</h5>
            <p><strong>Tên khách hàng:</strong> @(Model.Customer?.NameCus ?? "Không rõ")</p>
            <p><strong>Số điện thoại:</strong> @(Model.Customer?.PhoneCus ?? "Không rõ")</p>
            <p><strong>Địa chỉ giao hàng:</strong> @(Model.DeliveryAddress ?? "Không rõ")</p>
            <p><strong>Phương thức thanh toán:</strong> @(Model.PaymentMethod ?? "Không rõ")</p>
            <p><strong>Trạng thái:</strong> @(Model.Status ?? "Chưa cập nhật")</p>
            <p><strong>Ngày đặt:</strong> @(Model.DateOrder?.ToString("dd/MM/yyyy HH:mm"))</p>
            <p><strong>Tổng tiền:</strong> @((Model.TotalAmount ?? 0).ToString("N0")) VND</p>
        </div>
    </div>

    <!-- Products Table -->
    <h4 class="mb-3">Sản phẩm đã đặt</h4>

    <table class="table table-bordered table-striped shadow-sm">
        <thead class="table-warning text-center">
            <tr>
                <th>Hình</th>
                <th>Tên sản phẩm</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th>Thành tiền</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.OrderDetails)
            {
                var product = item.Product;
                var qty = item.Quantity ?? 0;
                var price = item.UnitPrice ?? 0;
                var total = qty * price;

                bool isFree = price == 0;

                <tr class="text-center align-middle @(isFree ? "table-success fw-bold" : "")">
                    <td style="width: 100px;">
                        <img src="@Url.Content("~/Content/Images/" + (product?.ImagePro ?? "noimage.jpg"))"
                             alt="@product?.NamePro"
                             class="img-thumbnail" style="height: 80px;" />
                    </td>

                    <td>
                        @(product?.NamePro ?? "Không rõ")
                        @if (isFree)
                        {
                            <span class="badge bg-success ms-2">FREE</span>
                        }
                    </td>

                    <td>@qty</td>

                    <td>
                        @if (isFree)
                        {
                            <span class="text-success fw-bold">FREE</span>
                        }
                        else
                        {
                            @price.ToString("N0") <text>VND</text>
                        }
                    </td>

                    <td>
                        @if (isFree)
                        {
                            <span class="text-success fw-bold">0 VND</span>
                        }
                        else
                        {
                            @total.ToString("N0") <text>VND</text>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div class="text-end mt-3">
        <a class="btn btn-secondary" href="@Url.Action("Orders", "Admin")">
            <i class="fa fa-arrow-left"></i> Quay lại danh sách đơn hàng
        </a>
    </div>

</div>